<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="shortcut icon" href="/assets/favicon.ico">

<!-- PWA / Manifest -->
<link rel="manifest" href="/assets/site.webmanifest">

<!-- Safari Pinned Tab -->
<link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fafcfb">

<!-- Microsoft / Windows Tiles -->
<meta name="msapplication-TileColor" content="#fafcfb">
<meta name="msapplication-TileImage" content="/assets/mstile-150x150.png">

<!-- Theme Color (Mobile Browser UI Color) -->
<meta name="theme-color" content="#fafcfb">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wow Carz Investment Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Oswald:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fff1f2; /* Light Red/Peach tint */
            background-image: linear-gradient(#fecaca 1px, transparent 1px), linear-gradient(90deg, #fecaca 1px, transparent 1px);
            background-size: 40px 40px;
            color: #1f2937;
        }

        /* Remove arrows from number inputs */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        /* Brand Logo Font */
        .brand-font {
            font-family: 'Oswald', sans-serif;
            letter-spacing: -0.5px;
        }

        /* Smooth Inputs */
        .custom-input {
            transition: all 0.2s ease;
            background: white;
        }
        .custom-input:focus-within {
            border-color: #ef4444; /* Brand Red */
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
        }

        /* Modern Slider Styling - Brand Red */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ef4444; /* Brand Red */
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.4);
            border: 2px solid white;
            transition: transform 0.1s;
        }
        
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #fecaca; /* Light Red */
            border-radius: 999px;
        }

        /* Card Hover */
        .hover-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .hover-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.1);
        }
            /* FAQ Modal & FAB */
            .faq-fab {
                position: fixed;
                right: 18px;
                bottom: 18px;
                z-index: 60;
                width: 56px;
                height: 56px;
                border-radius: 9999px;
                background: #ef4444;
                color: white;
                box-shadow: 0 8px 20px rgba(239,68,68,0.18);
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .faq-modal-backdrop {
                position: fixed;
                inset: 0;
                background: rgba(15,23,42,0.6);
                z-index: 70;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .faq-modal {
                width: 100%;
                max-width: 820px;
                max-height: 92vh;
                overflow: auto;
                background: white;
                border-radius: 14px;
                padding: 20px;
            }

            /* Accordion answer transitions */
            .faq-answer {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.28s ease, padding 0.2s ease;
                padding-top: 0;
            }
            .faq-answer.open {
                padding-top: 8px;
                max-height: 600px; /* large enough for answers */
            }

            .faq-section { display: block; }
            @media (max-width: 768px) {
                /* Hide the FAQ main section on mobile so it's not in main scroll flow */
                .faq-section { display: none; }

                /* Mobile: full screen modal */
                .faq-modal {
                    width: 100%;
                    height: 100%;
                    max-width: none;
                    max-height: 100vh;
                    border-radius: 0;
                }
            }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-red-50 to-white">
    <div class="flex flex-col min-h-screen">
        <!-- Navigation Bar -->
        <nav class="bg-white border-b border-red-50 sticky top-0 z-50 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 md:px-8 py-2 md:py-4 flex items-center justify-between gap-4">
                <!-- Logo + Title Stacked -->
                <div class="flex items-center gap-3 flex-shrink-0">
                    <h1 class="sr-only">Fleet ROI Calculator (EMI)</h1>
                    <img src="assets/wowcarz-logo.png" alt="WOW CARZ" class="h-10 md:h-12 flex-shrink-0" />
                    <div class="flex flex-col justify-center">
                        <span class="text-slate-900 font-bold text-sm md:text-lg leading-tight">Fleet ROI</span>
                        <span class="text-slate-500 font-medium text-xs md:text-sm leading-tight">Calculator (EMI)</span>
                    </div>
                </div>
                <!-- Desktop header links (next to logo, hidden on mobile) -->
                <div class="hidden md:flex items-center ml-4 mr-2 gap-2">
                    <button id="faqOpenDesktop" class="px-3 py-1.5 text-slate-600 hover:text-slate-900 rounded-lg hover:bg-slate-100 transition font-medium text-sm" aria-haspopup="dialog">FAQ</button>
                    <button id="aboutOpenDesktop" class="px-3 py-1.5 text-slate-600 hover:text-slate-900 rounded-lg hover:bg-slate-100 transition font-medium text-sm">About Us</button>
                    <button id="contactOpenDesktop" class="px-3 py-1.5 text-slate-600 hover:text-slate-900 rounded-lg hover:bg-slate-100 transition font-medium text-sm">Contact Us</button>
                </div>

                <!-- App & Website Links -->
                <div class="flex items-center gap-3 md:gap-4 flex-shrink-0">
                    <!-- Website Link -->
                    <a href="https://www.wowcarz.in/" target="_blank" rel="noopener noreferrer" title="Visit WOW CARZ Website" class="flex items-center gap-1.5 px-3 py-1.5 text-slate-600 hover:text-slate-900 rounded-lg hover:bg-slate-100 transition font-medium text-xs md:text-sm">
                        <i data-lucide="globe" class="w-4 h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">Website</span>
                    </a>
                    <!-- Google Play Link -->
                    <a href="https://play.google.com/store/apps/details?id=com.rocketflyer.wowcarz&pcampaignid=web_share" target="_blank" rel="noopener noreferrer" title="Download on Google Play" class="flex items-center gap-1.5 px-3 py-1.5 text-white bg-red-600 hover:bg-red-700 rounded-lg transition font-medium text-xs md:text-sm">
                        <i data-lucide="download" class="w-4 h-4 md:w-5 md:h-5"></i>
                        <span class="hidden sm:inline">Play Store</span>
                    </a>
                        
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 flex items-center justify-center p-4 md:p-8">
            <div class="max-w-6xl w-full bg-white rounded-3xl shadow-xl shadow-red-100 border border-red-50 overflow-hidden relative">

        <div class="flex flex-col lg:flex-row">
            
            <!-- LEFT PANEL: INPUTS -->
            <div class="w-full lg:w-5/12 p-6 md:p-10 space-y-8 border-r border-red-50 bg-white relative">
                
                <!-- 1. Investment Amount -->
                <section>
                    <label class="text-xs sm:text-sm font-bold text-gray-400 uppercase tracking-wider mb-2 block">Investment Amount</label>
                    <div class="rounded-2xl p-4 border border-gray-200 custom-input">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl sm:text-3xl text-gray-400 font-light">₹</span>
                            <input type="text" inputmode="numeric" id="amountInput" 
                                class="w-full bg-transparent text-2xl sm:text-3xl font-bold text-gray-900 outline-none placeholder-gray-300" 
                                placeholder="0" value="5,00,000">
                        </div>
                        <div class="mt-4">
                            <input type="range" id="amountRange" min="100000" max="10000000" step="10000" value="500000" class="w-full">
                        </div>
                    </div>
                </section>

                <!-- 2. Interest Rate -->
                <section>
                    <label class="text-xs sm:text-sm font-bold text-gray-400 uppercase tracking-wider mb-2 block">Annual Interest (EMI)</label>
                    <div class="rounded-xl border border-gray-200 p-3 custom-input flex items-center justify-between">
                        <input type="number" id="interestInput" class="text-lg sm:text-xl font-bold text-gray-900 w-24 outline-none" value="12">
                        <span class="text-gray-400 font-medium">%</span>
                    </div>
                    <input type="range" id="interestRange" min="5" max="30" step="0.5" value="12" class="w-full mt-3">
                </section>

                <!-- 3. Tenure -->
                <section>
                    <label class="text-xs sm:text-sm font-bold text-gray-400 uppercase tracking-wider mb-2 block">Tenure Duration</label>
                    <div class="rounded-xl border border-gray-200 p-3 custom-input flex items-center justify-between">
                        <input type="number" id="yearsInput" class="text-lg sm:text-xl font-bold text-gray-900 w-24 outline-none" value="3">
                        <span class="text-gray-400 font-medium">Years</span>
                    </div>
                    <input type="range" id="yearsRange" min="1" max="10" step="1" value="3" class="w-full mt-3">
                </section>

                <!-- 4. Resale -->
                <section>
                    <label class="text-xs sm:text-sm font-bold text-gray-400 uppercase tracking-wider mb-2 block">Resale Value %</label>
                    <div class="rounded-xl border border-gray-200 p-3 custom-input flex items-center justify-between">
                        <input type="number" id="resaleInput" class="text-lg sm:text-xl font-bold text-gray-900 w-24 outline-none" value="50">
                        <span class="text-gray-400 font-medium">% of Cap</span>
                    </div>
                    <input type="range" id="resaleRange" min="0" max="100" step="5" value="50" class="w-full mt-3">
                </section>

                 <!-- 5. Annual Expense -->
                 <section>
                    <div class="flex justify-between items-baseline mb-2">
                        <label class="text-xs sm:text-sm font-bold text-gray-400 uppercase tracking-wider block">Annual Expense (2nd Year+)</label>
                        <span class="text-[10px] sm:text-xs text-red-500 font-bold bg-red-50 px-2 py-0.5 rounded uppercase">FC & Insurance</span>
                    </div>
                    <div class="rounded-xl border border-gray-200 p-3 custom-input flex items-center justify-between">
                        <div class="flex items-center gap-1">
                            <span class="text-gray-400 font-medium">₹</span>
                            <input type="text" inputmode="numeric" id="expenseInput" class="text-lg sm:text-xl font-bold text-gray-900 w-32 outline-none" value="30,000">
                        </div>
                        <span class="text-gray-400 font-medium text-xs">/ year</span>
                    </div>
                    <input type="range" id="expenseRange" min="30000" max="100000" step="1000" value="30000" class="w-full mt-3">
                </section>

            </div>

            <!-- RIGHT PANEL: RESULTS -->
            <div class="w-full lg:w-7/12 bg-[#fff1f2]/50 p-6 md:p-10 flex flex-col justify-center relative overflow-hidden">
                
                <!-- Decoration Blob -->
                <div class="absolute top-0 right-0 w-96 h-96 bg-red-200 rounded-full blur-[120px] opacity-20 pointer-events-none"></div>

                <!-- BIG EMI Display -->
                <div class="mb-10 relative z-10">
                    <h3 class="text-xs sm:text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 flex items-center gap-2">
                        <i data-lucide="wallet" class="w-4 h-4 text-red-500"></i> Monthly Payout (EMI)
                    </h3>
                    <div class="flex items-baseline gap-2">
                        <div class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-[#ef4444] tracking-tight" id="monthlyEmi">₹ 0</div>
                        <span class="text-gray-400 font-medium text-sm md:text-base">/ month</span>
                    </div>
                    <p class="text-gray-500 mt-2 text-xs sm:text-sm">
                        Fixed payout every month for <span id="txtYears1" class="font-bold text-gray-800">3</span> years.
                    </p>
                </div>

                <!-- The Equation Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
                    
                    <!-- Box 1: Total EMI Income Breakdown -->
                    <div class="bg-white p-5 rounded-2xl border border-red-100 shadow-sm flex flex-col hover-card">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <div class="p-1.5 bg-red-50 rounded text-red-500">
                                    <i data-lucide="calendar-check" class="w-4 h-4"></i>
                                </div>
                                <span class="text-xs sm:text-sm font-bold text-gray-400 uppercase">Total EMI Income</span>
                            </div>
                            <div class="text-xl sm:text-2xl font-bold text-gray-800" id="totalEmiIncome">₹ 0</div>
                        </div>
                        
                        <!-- Breakdown Section -->
                        <div class="border-t border-gray-100 pt-2 mt-2 space-y-1">
                            <div class="flex justify-between items-center text-[11px] sm:text-xs">
                                <span class="text-gray-500">Principal Return</span>
                                <span class="font-semibold text-gray-700" id="breakdownPrincipal">₹ 0</span>
                            </div>
                            <div class="flex justify-between items-center text-[11px] sm:text-xs">
                                <span class="text-gray-500">Interest Earned</span>
                                <span class="font-bold text-green-600" id="breakdownInterest">₹ 0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Box 2: Resale Value -->
                    <div class="bg-white p-5 rounded-2xl border border-red-100 shadow-sm flex flex-col hover-card">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <div class="p-1.5 bg-red-50 rounded text-red-500">
                                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                </div>
                                <span class="text-xs sm:text-sm font-bold text-gray-400 uppercase">Resale Value</span>
                            </div>
                            <div class="text-xl sm:text-2xl font-bold text-gray-800" id="resaleValue">₹ 0</div>
                        </div>
                        <div class="text-[11px] sm:text-xs text-gray-400 mt-2 pt-2 border-t border-gray-100">
                            Lump sum received at the end of the <span id="txtYears2">3</span> year tenure.
                        </div>
                    </div>

                </div>

                <!-- Grand Total Card (Dark Red Theme) -->
                <div class="mt-8 relative z-10">
                    <div class="bg-[#ef4444] rounded-2xl p-4 sm:p-6 shadow-xl shadow-red-200 transform transition hover:scale-[1.01] text-white">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h3 class="text-red-100 text-xs sm:text-sm font-bold uppercase tracking-widest mb-1 opacity-80">Total Return Value</h3>
                                <div class="text-3xl sm:text-4xl md:text-5xl font-bold text-white tracking-tight" id="grandTotal">₹ 0</div>
                                <div class="text-red-50 text-xs sm:text-sm mt-1 opacity-90">EMI + Resale - Expenses</div>
                            </div>
                            
                            <div class="flex flex-col items-end">
                                 <!-- Profit Badge: White on Red -->
                                 <div id="profitBadge" class="bg-white/95 text-green-700 px-3 sm:px-6 py-2 sm:py-3 rounded-2xl text-sm sm:text-xl font-bold flex items-center gap-2 sm:gap-3 mb-1 shadow-lg">
                                    <i data-lucide="trending-up" class="w-4 h-4 sm:w-6 sm:h-6"></i>
                                    <span id="profitText">Profit: ₹ 0</span>
                                 </div>
                                 <div class="text-[10px] sm:text-xs text-red-100 font-medium" id="expenseNote">
                                    (Net of expenses)
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
            </div>
        </main>
        <!-- Inline FAQ removed; modal will be used for both desktop and mobile access -->

        <!-- Mobile: Floating FAQ Button (opens modal) -->
        <button id="faqFab" class="faq-fab md:hidden" aria-label="Open FAQ">
            <i data-lucide="help-circle" class="w-6 h-6"></i>
        </button>

        <!-- FAQ Modal Backdrop (shared desktop & mobile) -->
        <div id="faqBackdrop" class="faq-modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
            <div class="faq-modal" role="document" aria-labelledby="faqTitle">
                <div class="flex items-center justify-between mb-3">
                    <h3 id="faqTitle" class="text-lg font-bold text-gray-800 flex items-center gap-2"><i data-lucide="help-circle" class="w-5 h-5 text-red-600"></i> Frequently Asked Questions</h3>
                    <button id="faqClose" class="text-gray-500 hover:text-gray-800" aria-label="Close FAQ">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>

                <div id="faqList" class="space-y-2">
                    <!-- Accessible accordion items -->
                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq1"> 
                            <span class="font-semibold text-gray-700">Ownership & Asset Security — In whose name will the car be registered?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq1" class="faq-answer px-4 pb-4 text-gray-600" hidden>The vehicle is registered in the Company’s Name. By keeping the registration with us, we legally shield you from third-party liabilities and claims while you remain the financial beneficiary.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq2">
                            <span class="font-semibold text-gray-700">What happens to the car after 3 years?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq2" class="faq-answer px-4 pb-4 text-gray-600" hidden>At the end of the tenure, the asset is returned to you (or liquidated on your behalf), ensuring you realize the residual value.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq3">
                            <span class="font-semibold text-gray-700">Can I use the car for personal trips?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq3" class="faq-answer px-4 pb-4 text-gray-600" hidden>No. To maintain tax-compliant commercial status and guaranteed availability for corporate clients, vehicles remain dedicated to business operations during tenure.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq4">
                            <span class="font-semibold text-gray-700">Can I track my vehicle via GPS?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq4" class="faq-answer px-4 pb-4 text-gray-600" hidden>No. Tracking is monitored centrally for safety and client privacy; external real-time access is not shared.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq5">
                            <span class="font-semibold text-gray-700">Can I physically inspect my vehicle?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq5" class="faq-answer px-4 pb-4 text-gray-600" hidden>Yes — inspections are welcome by prior scheduling at our hub.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq6">
                            <span class="font-semibold text-gray-700">Is there a lock-in period? Can I exit early?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq6" class="faq-answer px-4 pb-4 text-gray-600" hidden>The agreement is a fixed 3-year tenure to support long-term contracts; early exit is restricted because it would disrupt SLAs.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq7">
                            <span class="font-semibold text-gray-700">What if my car is not booked for a month? Do I still get paid?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq7" class="faq-answer px-4 pb-4 text-gray-600" hidden>Yes. Your monthly payout is fixed and guaranteed; we absorb utilization risk.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq8">
                            <span class="font-semibold text-gray-700">When do I receive my monthly payout?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq8" class="faq-answer px-4 pb-4 text-gray-600" hidden>Payouts are processed monthly between the 15th and 25th directly to your registered bank account.</div>
                    </div>

                    <div class="faq-item border border-gray-100 rounded-lg overflow-hidden">
                        <button class="faq-question w-full text-left p-4 flex justify-between items-center bg-white" aria-expanded="false" aria-controls="faq9">
                            <span class="font-semibold text-gray-700">Are there any hidden charges I need to pay later?</span>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <div id="faq9" class="faq-answer px-4 pb-4 text-gray-600" hidden>The investor is responsible for insurance renewal (from year 2), FC renewal, and state permit fees; operational damages are covered by WowCarz.</div>
                    </div>

                    <!-- Slides removed: modal now contains full FAQ. -->
                    <div class="mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        /* --- UTILS --- */
        const formatIndian = (num) => {
            if (num === null || num === undefined || isNaN(num)) return "0";
            let x = Math.round(num).toString();
            let lastThree = x.substring(x.length - 3);
            let otherNumbers = x.substring(0, x.length - 3);
            if (otherNumbers !== '') {
                lastThree = ',' + lastThree;
            }
            return otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree;
        };

        const formatCurrency = (num) => "₹ " + formatIndian(num);

        /* --- DOM ELEMENTS --- */
        const els = {
            // Inputs & Sliders
            amountInput: document.getElementById('amountInput'),
            amountRange: document.getElementById('amountRange'),
            
            interestInput: document.getElementById('interestInput'),
            interestRange: document.getElementById('interestRange'),
            
            yearsInput: document.getElementById('yearsInput'),
            yearsRange: document.getElementById('yearsRange'),
            
            resaleInput: document.getElementById('resaleInput'),
            resaleRange: document.getElementById('resaleRange'),

            expenseInput: document.getElementById('expenseInput'),
            expenseRange: document.getElementById('expenseRange'),

            // Displays
            monthlyEmi: document.getElementById('monthlyEmi'),
            totalEmiIncome: document.getElementById('totalEmiIncome'),
            
            // New Breakdown IDs
            breakdownPrincipal: document.getElementById('breakdownPrincipal'),
            breakdownInterest: document.getElementById('breakdownInterest'),

            resaleValue: document.getElementById('resaleValue'),
            grandTotal: document.getElementById('grandTotal'),
            profitText: document.getElementById('profitText'),
            profitBadge: document.getElementById('profitBadge'),
            expenseNote: document.getElementById('expenseNote'),
            txtYears1: document.getElementById('txtYears1'),
            txtYears2: document.getElementById('txtYears2')
        };

        /* --- LOGIC --- */
        function calculate() {
            // Parse inputs
            let rawAmount = els.amountInput.value.replace(/,/g, '');
            let P = parseFloat(rawAmount) || 0;
            
            let R = parseFloat(els.interestInput.value) || 0;
            let N = parseFloat(els.yearsInput.value) || 0;
            let ResalePct = parseFloat(els.resaleInput.value) || 0;

            let rawExpense = els.expenseInput.value.replace(/,/g, '');
            let ExpensePerYear = parseFloat(rawExpense) || 0;

            // Update Text Labels
            els.txtYears1.innerText = N;
            if(els.txtYears2) els.txtYears2.innerText = N;

            // EMI Logic
            let r = R / 12 / 100;
            let n = N * 12;

            let emi = 0;
            if (P > 0 && n > 0) {
                if (R === 0) emi = P / n;
                else emi = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            }

            let totalEmi = emi * n;
            
            // Breakdown Calculation
            let principalComponent = (P > 0) ? P : 0;
            let interestComponent = (totalEmi > P) ? (totalEmi - P) : 0;
            
            let resaleVal = P * (ResalePct / 100);
            
            // Expense Logic: Applied in 2nd and 3rd year (etc)
            let expenseYears = (N > 1) ? (N - 1) : 0;
            let totalExpense = ExpensePerYear * expenseYears;

            // NEW CALCULATION: Total Return now deducts Expenses
            let totalReturn = totalEmi + resaleVal - totalExpense;

            // Net Profit
            let profit = totalReturn - P;

            // Render
            els.monthlyEmi.innerText = formatCurrency(emi);
            els.totalEmiIncome.innerText = formatCurrency(totalEmi);
            
            // Render Breakdown
            els.breakdownPrincipal.innerText = formatCurrency(principalComponent);
            els.breakdownInterest.innerText = formatCurrency(interestComponent);

            els.resaleValue.innerText = formatCurrency(resaleVal);
            els.grandTotal.innerText = formatCurrency(totalReturn);
            els.expenseNote.innerText = `(Expenses: ${formatCurrency(totalExpense)} deducted)`;

            // Profit Styling - BIGGER BADGE
            if(profit >= 0) {
                els.profitText.innerText = `Profit: +${formatIndian(profit)}`;
                els.profitText.parentElement.classList.remove('text-red-600');
                els.profitText.parentElement.classList.add('text-green-700');
            } else {
                els.profitText.innerText = `Loss: ${formatIndian(profit)}`;
                els.profitText.parentElement.classList.remove('text-green-700');
                els.profitText.parentElement.classList.add('text-red-600');
            }
        }

        /* --- SYNC FUNCTION --- */
        // Connects a Text Input to a Range Slider bi-directionally
        function setupSync(input, range, isCurrency = false) {
            
            // Text Input Listener
            input.addEventListener('input', (e) => {
                let val = e.target.value;
                
                // If currency, handle commas
                if (isCurrency) {
                    // strip non-numeric
                    let clean = val.replace(/[^0-9]/g, '');
                    if (clean === '') {
                        range.value = 0; 
                        calculate(); 
                        return;
                    }
                    let num = parseInt(clean, 10);
                    // Update visuals
                    input.value = formatIndian(num); 
                    range.value = num;
                } else {
                    // Standard number inputs
                    if (val === '') {
                         calculate(); 
                         return;
                    }
                    range.value = val;
                }
                calculate();
            });

            // Range Slider Listener
            range.addEventListener('input', (e) => {
                let val = e.target.value;
                if (isCurrency) {
                    input.value = formatIndian(val);
                } else {
                    input.value = val;
                }
                calculate();
            });
        }

        /* --- INITIALIZE --- */
        setupSync(els.amountInput, els.amountRange, true); // True for currency
        setupSync(els.interestInput, els.interestRange);
        setupSync(els.yearsInput, els.yearsRange);
        setupSync(els.resaleInput, els.resaleRange);
        setupSync(els.expenseInput, els.expenseRange, true); // Expense is currency

        // First run
        calculate();

        /* --- FAQ: Modal (mobile) and Accordion (desktop) --- */
        const faqFab = document.getElementById('faqFab');
        const faqBackdrop = document.getElementById('faqBackdrop');
        const faqClose = document.getElementById('faqClose');
        const faqOpenDesktop = document.getElementById('faqOpenDesktop');
        const aboutOpenDesktop = document.getElementById('aboutOpenDesktop');
        const contactOpenDesktop = document.getElementById('contactOpenDesktop');
        const faqModalContainer = document.querySelector('.faq-modal');
        const faqTitle = document.getElementById('faqTitle');
        const faqList = document.getElementById('faqList');

        let lastFocusedEl = null;
        const originalFaqHtml = faqList ? faqList.innerHTML : '';

        function closeAllAccordion(){
            document.querySelectorAll('.faq-answer.open').forEach(a => {
                a.classList.remove('open');
                a.hidden = true;
                const btn = a.previousElementSibling;
                if(btn) btn.setAttribute('aria-expanded','false');
                const icon = btn && btn.querySelector('i[data-lucide]'); if(icon) icon.style.transform = 'rotate(0deg)';
            });
        }

        function wireAccordion(){
            document.querySelectorAll('.faq-question').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.getAttribute('aria-controls');
                    const content = document.getElementById(id);
                    if(!content) return;
                    const isOpen = content.classList.contains('open');
                    if(!isOpen){ closeAllAccordion(); content.hidden = false; setTimeout(()=> content.classList.add('open'), 10); btn.setAttribute('aria-expanded','true'); const icon = btn.querySelector('i[data-lucide]'); if(icon) icon.style.transform = 'rotate(180deg)'; }
                    else { content.classList.remove('open'); btn.setAttribute('aria-expanded','false'); const icon = btn.querySelector('i[data-lucide]'); if(icon) icon.style.transform = 'rotate(0deg)'; setTimeout(()=> content.hidden = true, 250); }
                });
            });
        }

        function openModal(type){
            if(!faqBackdrop || !faqList) return;
            lastFocusedEl = document.activeElement;
            // push history so Android back closes modal
            try{ history.pushState({modalOpen:true, type:type}, ''); }catch(e){}
            // populate content
            if(type === 'faq'){
                faqTitle.innerText = 'Frequently Asked Questions';
                faqList.innerHTML = originalFaqHtml;
            } else if(type === 'about'){
                faqTitle.innerText = 'About Us';
                faqList.innerHTML = `
                    <div class="px-1 pb-2 text-gray-700">
                        <h4 class="text-lg font-semibold text-gray-800 mb-2">WowCarz — Drive Your Future</h4>
                        <p class="text-sm text-gray-600 mb-2">We have been proudly delivering reliable self-drive and fleet services since 2016. Our mission is to make travel seamless and stress-free by offering well-maintained cars with hygienic interiors at affordable prices. Whether it’s a short trip or a long journey, we are committed to providing a comfortable, safe, and enjoyable experience for every customer.</p>
                        <p class="text-sm text-gray-600 mb-2">For investors and partners, WowCarz operates a professionally managed fleet with strong operational controls, privacy safeguards, and transparent financial models.</p>
                        <p class="text-sm text-gray-600">Learn more about our services and expansion plans by contacting our team.</p>
                    </div>`;
            } else if(type === 'contact'){
                faqTitle.innerText = 'Contact Us';
                faqList.innerHTML = `
                    <div class="space-y-3 text-sm text-gray-700">
                        <div>
                            <strong>Address</strong>
                            <div>#1029, 17TH Main Road, 2nd Block, BTM 4th Stage, Bangalore, 560076.</div>
                        </div>
                        <div>
                            <strong>Phone</strong>
                            <div><a href="tel:+919844300066" class="text-red-600 hover:underline">+91 98443 00066</a></div>
                        </div>
                        <div>
                            <strong>Emails</strong>
                            <div><a href="mailto:support@wowcarz.in" class="text-red-600 hover:underline">support@wowcarz.in</a></div>
                            <div><a href="mailto:feedback@wowcarz.in" class="text-red-600 hover:underline">feedback@wowcarz.in</a></div>
                            <div><a href="mailto:franchise@wowcarz.in" class="text-red-600 hover:underline">franchise@wowcarz.in</a></div>
                        </div>
                    </div>`;
            }

            faqBackdrop.style.display = 'flex';
            faqBackdrop.setAttribute('aria-hidden','false');
            document.body.style.overflow = 'hidden';
            // wire accordion only if faq items present
            setTimeout(()=>{
                wireAccordion();
                const firstBtn = faqBackdrop.querySelector('.faq-question');
                if(firstBtn) firstBtn.focus();
            }, 50);
        }

        function closeModal(fromPopState){
            if(!faqBackdrop) return;
            faqBackdrop.style.display = 'none';
            faqBackdrop.setAttribute('aria-hidden','true');
            document.body.style.overflow = '';
            if(lastFocusedEl) lastFocusedEl.focus();
            if(!fromPopState){ try{ if(history.state && history.state.modalOpen) history.back(); }catch(e){} }
            // restore original content to keep DOM consistent
            faqList.innerHTML = originalFaqHtml;
        }

        if(faqFab) faqFab.addEventListener('click', ()=> openModal('faq'));
        if(faqOpenDesktop) faqOpenDesktop.addEventListener('click', ()=> openModal('faq'));
        if(aboutOpenDesktop) aboutOpenDesktop.addEventListener('click', ()=> openModal('about'));
        if(contactOpenDesktop) contactOpenDesktop.addEventListener('click', ()=> openModal('contact'));
        if(faqClose) faqClose.addEventListener('click', () => closeModal(false));
        if(faqBackdrop) faqBackdrop.addEventListener('click', (e) => { if(e.target === faqBackdrop) closeModal(false); });

        // ESC to close
        document.addEventListener('keydown', (e) => {
            if(e.key === 'Escape' && faqBackdrop && faqBackdrop.style.display === 'flex'){
                closeModal(false);
            }
        });

        // handle back button to close modal
        window.addEventListener('popstate', (e) => {
            if(faqBackdrop && faqBackdrop.style.display === 'flex'){
                closeModal(true);
            }
        });

    </script>
</body>
</html>